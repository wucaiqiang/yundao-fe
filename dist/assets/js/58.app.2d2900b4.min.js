webpackJsonp([58],{1695:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return f.default.createElement(B,e)}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),c=r(0),f=a(c),d=(r(85),r(153)),p=r(42),m=r(84),h=a(m),g=r(358),w=a(g),y=r(155),v=a(y),b=r(95),E=a(b),P=r(189),O=a(P),k=r(732),_=a(k),S=r(735),C=a(S),N=p.Form.Item,j=function(e){function t(){var e,r,a,l;n(this,t);for(var s=arguments.length,i=Array(s),u=0;u<s;u++)i[u]=arguments[u];return r=a=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),a.state={login:!1,logining:!1},a.handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){if(a.state.logining)return;a.setState({logining:!0}),a.auth.getCode().then(function(e){if(!e||!e.success)return void a.setState({logining:!1});var r=e.result,n=JSON.parse(JSON.stringify(t));Promise.all([a.auth.rsa(n.newPassword,r),a.auth.rsa(n.oldPassword,r)]).then(function(e){var t=e[0],r=e[1];a.user.changePwd({oldPassword:r,newPassword:t}).then(function(e){a.setState({logining:!1}),e.success&&(E.default.setCookie("ticket","",-1),p.Modal.success({title:"密码修改保存成功,请重新登录.",okText:"确定",onOk:function(){a.props.history.replace("/login")}}))})})})}})},a.handleConfirmBlur=function(e){var t=e.target.value;a.setState({confirmDirty:a.state.confirmDirty||!!t})},a.checkPassword=function(e,t,r){t&&t!==a.props.form.getFieldValue("newPassword")?r("两次输入密码不一致"):r()},a.checkConfirm=function(e,t,r){t&&a.state.confirmDirty&&a.props.form.validateFields(["confirmPassword"],{force:!0}),r()},l=r,o(a,l)}return l(t,e),u(t,[{key:"componentWillMount",value:function(){this.height=window.innerHeight,this.auth=new O.default,this.user=new _.default}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.props,r=(t.history,t.location),a=(t.match,(0,d.matchRoutes)(v.default,r.pathname));return f.default.createElement(w.default,i({},this.props,{route:a[0].route}),f.default.createElement("div",{className:C.default.body,style:{height:this.height}},f.default.createElement("div",{className:C.default.content},f.default.createElement(p.Form,{onSubmit:this.handleSubmit,className:C.default.form},f.default.createElement("h1",{className:C.default.title},"首次登录，请重置初始化密码"),f.default.createElement("div",{className:C.default.caption}),f.default.createElement("div",{className:C.default.formitem},f.default.createElement(N,null,e("oldPassword",{validateTrigger:["onBlur"],rules:[{required:!0,message:"请输入当前密码"}]})(f.default.createElement(p.Input,{placeholder:"当前密码",type:"password",autoComplete:"new-password"}))),f.default.createElement(N,null,e("newPassword",{validateTrigger:["onBlur"],rules:[{required:!0,message:"请输入新密码"},{message:"6-20位，不能是纯字母或纯数字",pattern:new RegExp("^(?![d]+$)(?![a-zA-Z]+$)(?![^da-zA-Z]+$).{6,20}$")},{validator:this.checkConfirm}]})(f.default.createElement(p.Input,{placeholder:"新密码",type:"password",autoComplete:"new-password"}))),f.default.createElement(N,null,e("confirmPassword",{validateTrigger:["onBlur"],rules:[{required:!0,message:"请输入确认密码"},{validator:this.checkPassword}]})(f.default.createElement(p.Input,{type:"password",placeholder:"确认密码",autoComplete:"new-password",onBlur:this.handleConfirmBlur}))),f.default.createElement(N,null,f.default.createElement(p.Button,{loading:this.state.logining,type:"primary",htmlType:"submit",className:C.default.btnSubmit},"保存"))))),f.default.createElement("div",{className:C.default.footer},f.default.createElement("img",{src:"/assets/images/login/logo@1x.png"}))))}}]),t}(h.default),B=p.Form.create()(j);t.default=s}});