webpackJsonp([60],{1637:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return d.default.createElement(C,e)}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},u=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),c=a(0),d=n(c),f=a(85),m=a(153),p=a(42),h=a(155),g=n(h),b=a(84),v=n(b),E=a(358),y=n(E),w=a(95),S=n(w),T=a(732),x=n(T),k=a(735),N=n(k),O=p.Form.Item,_=function(e){function t(){var e,n,o,s;l(this,t);for(var i=arguments.length,u=Array(i),c=0;c<i;c++)u[c]=arguments[c];return n=o=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),o.state={loading:!1,step:1,disabled:!1,tipText:"请输入您要找回登录密码的手机号",btnText:"发送验证码"},o.handleNextStep=function(){o.props.form.validateFields(function(e,t){e||o.state.loading||(S.default.setStorage("mobile",t.mobile),o.firstStepData=t,o.user.check_mobile(t.mobile).then(function(e){e.success&&e.result.commonExist?o.setState({step:2,tipText:""}):p.message.warning("手机号不存在!")}))})},o.handleSubmit=function(e){e.preventDefault(),o.props.form.validateFields(function(e,t){if(!e&&!o.state.loading){var n=o;o.user.getCode().then(function(e){if(e.success){var l=e.result,r=l.exponent,o=l.modulus,s=l.random;return new Promise(function(e){e()}).then(function(){var e=a(154),l=e.getKeyPair(r,"",o),i=t.password;s&&(i=i+","+s);var u=e.encryptedString(l,i),c=Object.assign(t,n.firstStepData,{password:u});n.user.forgotPwd(c).then(function(e){e.success&&(p.message.success("密码找回成功，请使用新密码登录"),document.getElementById("loginLink").click())})}.bind(null,a)).catch(a.oe)}})}})},o.handleSendCode=function(){o.user.sendCaptcha(o.firstStepData.mobile).then(function(e){e.success&&(o.setState({disabled:!0,tipText:"验证码已发送至"+o.firstStepData.mobile}),o.seconds=59,o.Timer=setInterval(o.handerTimer,1e3))})},o.handerTimer=function(){o.seconds>1?o.setState({btnText:o.seconds+"秒后重发"}):(clearInterval(o.Timer),o.setState({btnText:"重发验证码",disabled:!1})),o.seconds=o.seconds-1},s=n,r(o,s)}return o(t,e),u(t,[{key:"componentWillMount",value:function(){this.user=new x.default,this.height=window.innerHeight}},{key:"componentUnMount",value:function(){clearInterval(this.Timer)}},{key:"render",value:function(){var e=this.state,t=e.loading,a=e.step,n=e.disabled,l=e.tipText,r=e.btnText,o=this.props.form.getFieldDecorator,s=this.props,u=(s.history,s.location),c=(s.match,(0,m.matchRoutes)(g.default,u.pathname));S.default.getStorage("userInfo");return d.default.createElement(y.default,i({},this.props,{route:c[0].route}),d.default.createElement("div",{className:N.default.body,style:{height:this.height}},d.default.createElement("div",{className:N.default.content},d.default.createElement(p.Form,{className:N.default.form,onSubmit:this.handleSubmit,autoComplete:"off"},d.default.createElement("h1",{className:N.default.title},"找回密码"),d.default.createElement("div",{className:N.default.caption},l),1===a?d.default.createElement("div",{className:N.default.formitem},d.default.createElement(O,null,o("mobile",{initialValue:S.default.getStorage("mobile"),validateTrigger:["onBlur"],rules:[{required:!0,message:"请输入手机号码!"},{message:"手机号码格式错误",pattern:new RegExp("^1[34578]\\d{9}$")}]})(d.default.createElement(p.Input,{placeholder:"手机号码"}))),d.default.createElement(O,null,d.default.createElement(p.Button,{onClick:this.handleNextStep},"下一步"))):d.default.createElement("div",{className:N.default.formitem},d.default.createElement(O,null,o("captcha",{rules:[{required:!0,message:"请输入收到的验证码!"}]})(d.default.createElement(p.Input,{placeholder:"请输入收到的验证码",autoComplete:"new-password"})),d.default.createElement(p.Button,{className:N.default.btnCode,disabled:n,onClick:this.handleSendCode},r)),d.default.createElement(O,null,o("password",{validateTrigger:["onBlur"],rules:[{required:!0,message:"请输入新密码!"},{message:"6-20位，不能是纯字母或纯数字",pattern:new RegExp("^(?![d]+$)(?![a-zA-Z]+$)(?![^da-zA-Z]+$).{6,20}$")}]})(d.default.createElement(p.Input,{type:"password",placeholder:"新密码",autoComplete:"new-password"}))),d.default.createElement(O,null,d.default.createElement(p.Button,{loading:t,htmlType:"submit"},"确定"))),d.default.createElement("div",{className:N.default.links},"想起密码?",d.default.createElement(f.Link,{className:N.default.login,id:"loginLink",to:"/login"},"直接登录")))),d.default.createElement("div",{className:N.default.footer},d.default.createElement("img",{src:"/assets/images/login/logo@1x.png"}))))}}]),t}(v.default),C=p.Form.create()(_);t.default=s}});